---
title: 计算机网络（上）
seo_title: seo名称
toc: true
indent: true
top: false
comments: true
archive: true
cover: false
mathjax: false
pin: false
top_meta: false
bottom_meta: false
sidebar:
  - toc
tag:
  - 计算机网络
  - 《计算机网络自顶向下》
categories: 计算机基础
keywords: 文章关键词
updated: ''
img: /medias/featureimages/31.webp
date:
summary: 计算机网络
---
# 计算机网络（上）
## 计算机网络基础
### 1.引言
#### 1.1基本概念
**①网络**
>由若干**节点**和连接节点的**链路**组成
{%list%}
按照拓扑类型可分为总线型、星型、环形和网状型
{%endlist%}

**②互联网**
>**多个网络**由**路由器**互联，形成**互联网**
{%list%}
因特网是最大的互联网，使用TCP/IP协议
{%endlist%}

**③ISP**
>**因特网服务提供商**，如中国**电信**、中国**联通**等
{%list%}
类似于树结构，只要有子节点就是父节点，所以个人也可以成为某种意义上的ISP
{%endlist%}

**④分组交换**
{%list%}
计算机网络传输信息方式
{%endlist%}
>将**数据**分成**多个包**，每个包由**描述信息**和**数据部分**组成

>**路由器**收到包后，**暂时存储**，根据**描述信息**送到**下一个路由器**，直到送到**目标地址**

>**目的地址**收到**所有包**后，根据**描述信息**将其**组合到一起**
{%right%}
无需建立连接、线路利用率高、出错时重发数据量小
{%endright%}
{%wrong%}
有转发时延、需要传递额外的信息、出错频率变大
{%endwrong%}

**⑤网络性能指标**
>**速率**：**设备**在**单位时间**传递的**比特数**

>**带宽**：**网络**中**一个点**到**另一个点**的**最高速率**

>**吞吐量**：**单位时间**内能**通过整个网络**的数据量，受到**带宽**和**速率**的限制

>**时延**：由**发送时延**、**传播时延**和**处理时延**组成

>**利用率**：网络中所有**信道利用率**的**加权平均**

>**丢包率**：一定时间内，**丢失的分组**数量占**总分组**数量的**比例**
{%right%}
利用率最好保持在50%左右，因为利用率越高，时延越大
{%endright%}
{%list%}
当分包出现误码，或者网络拥塞时会被丢弃，主要为后者
{%endlist%}

#### 1.2TCP/IP体系结构
**①构成**
{%right%}
真实的TCP/IP结构只有应用层、运输层、网络层和接口层四层，为了方便理解，将接口层拆解为链路层和物理层
{%endright%}
{%list%}
网络层是核心
{%endlist%}
>**应用层**：解决**进程间的交互**问题

>**运输层**：解决**进程**之间**基于网络通信**的问题

>**网络层**：解决多个**分组**在**网络间传输**的问题

>**链路层**：解决**分组**在**一个网络中传输**的问题

>**物理层**：解决使用**何种信号传输比特**的问题

**②基本概念**
>**实体**：可以**发送和接收消息**的**硬件**或者**软件**
{%list%}
收发双方相同层次的对应实体为对等实体
{%endlist%}
>**协议**：控制两个**对等实体**进行**逻辑通信的规则**，**对等层次**之间交换的**数据包**称为**协议数据单元PDU**
{%list%}
如应用层的HTTP协议，运输层的TCP协议，网络层的IP协议，链路层的CSMA协议，物理层的曼彻斯特编码等
{%endlist%}
>**服务**：**下层**给**相邻上层**提供的**功能接口**，**相邻层**之间交换的**数据包**称为**服务数据单元SDU**
{%list%}
相邻两层通过服务访问点交换信息，通过服务原语沟通
{%endlist%}

**③工作原理概述**
{%right%}
本质上层层包装，层层读取信息，以用户向一个网站服务器发出访问申请为例
{%endright%}
>**应用层**将**HTTP报文**发送给**运输层**
{%list%}
HTTP报文用于个人电脑和服务端的通信
{%endlist%}
>**运输层**给**HTTP报文**添加**TCP首部**，形成**TCP报文段**，并将其发送给**网络层**
{%list%}
TCP首部用于区分进程并实现可靠传输
{%endlist%}
>**网络层**给**TCP报文段**添加**IP首部**，形成**IP数据报**，并将其发送给**链路层**
{%list%}
IP首部使其可被路由器转发
{%endlist%}
>**链路层**给**IP数据报**添加**ETH首部**和**ETH尾部**，形成**帧**，并将其发送给**物理层**
{%list%}
ETH首部包含了目的地址和源地址，ETH尾部用于检查其是否有误码
{%endlist%}
>**物理层**将**帧**转化为**01序列**，添加**前导码**，发送到**下一个端口**
{%list%}
前导码让下一个端口做好接收准备
{%endlist%}
>运送到**路由器**后，一层一层**读取信息（如从IP首部获得转发端口）**，再一层一层**包装**发送到**下一个端口**，如此往复，直到**到达目的地**
{%list%}
路由器由于没有进程，所以没有应用端和运输端
{%endlist%}
![TCP/IP体系结构工作原理](/image/JW_1.png)

### 2.物理层
#### 2.1引言
**①协议**
>**比特流传递时**的**描述信息**，可分为**机械特性**、**电气特性**、**功能特性**和**过程特性**
{%list%}
物理层考虑的是如何在不同的传输媒体上传输数据比特流，传输媒体可分为导引型（如光纤）和非导引型（如wifi）
{%endlist%}
**②传输方式**
>**串行传输**：一次发送**一个比特**
**并行传输**：一次发送**多个比特**
{%list%}
计算机内部通信采用并行传输，计算机之间通信采用串行传输
{%endlist%}
>**同步传输**：**字节**之间**没有间隔**，需要保证**收发双方时钟同步**
**异步传输**：**字节**之间有**不固定的间隔**，在**每个字节前后**加上**起始位**和**结束位**

#### 2.2编码与调制
**①引言**
{%list%}
对于数字信号和模拟信号，编码和调制的含义不同，计算机网络主要使用数字信号，故只介绍数字信号
{%endlist%}
>**编码**：**不改变信号性质**，仅仅对**信号波形**进行变换

>**调制**：将**数字信号**的**频率范围搬移到较高的频段**，并**转化为模拟信号**

![信号传递过程](/image/JW_2.png)

**②编码方法**
>**曼彻斯特编码**：在**每个码元**的**中间时刻**发生**跳变**，使用**正负跳变**表示比特

>**差分曼彻斯特编码**：跳变**仅仅表示时钟**，使用**码元开始处电平是否变化**表示比特

**③调制方法**
>**基本调制方法**有**调幅**、**调频**和**调相**，但是这样**一个码元**只包含**一个比特信息**
{%list%}
采用混合调制方法，如正交振幅调制QAM，一个码元可以表示16种信息
{%endlist%}
#### 2.3信道极限容量
**①引言**
{%warning%}
当信号通过信道传输时，可能会导致失真，失真严重时将无法识别
{%endwarning%}
>**影响因素**：**码元传输速率**、**信号传输距离**、**噪声干扰**和**传输媒体质量**等

**②奈式准则**
>为了避免**码间串扰**。**码元传输速率**是有**上限**的
{%warning%}
奈式准则是理想情况（无噪声），实际上能传输的最高码元速率要远低于奈式准则给出的
{%endwarning%}
**③香农公式**
>给出了**带宽受限**且有**高斯白噪声干扰**的信道的**极限信息传输速率**
{%right%}
想要提高信息的传输速率必须采用更好的调制方法和信道的信噪比
{%endright%}

### 3.链路层
#### 3.1基本功能
**①包装成帧**
>**帧头**和**帧尾**包含重要的**控制信息**
{%list%}
主要内容为目的地址、源地址和帧校验序列
{%endlist%}
{%right%}
如果帧的其他部分也包含帧定界标志，需要与真正的帧定界符相区分，如插入“转义字符”
{%endright%}
**②差错检测**
>**传输过程**中，**比特**可能发生**反转**或者**丢失**，通过**帧校验序列**检测
{%list%}
常用的检测方法为循环冗余检测，两边对数据采用同样的算法，若结果一致则无误码
{%endlist%}
**③可靠传输**
>当出现**分组错误**、**分组丢失**、**分组失序**和**分组重复**等错误时，需要发送方**重新发送**
{%list%}
可靠传输不是必须的，通常误码率高时（如无线传输），需要可靠传输服务
{%endlist%}
{%right%}
可靠传输这一概念并不局限于链路层
{%endright%}
#### 3.2可靠传输协议
**①停止等待协议SW**
>**接收方**：每次**接收一个分组**，若接收到**正确的分组**，发送**确认分组**，**反之**则发送**否认分组**

>**发送方**：每次**发送一个分组**，只有**接收到确认分组**后再**发送下一分组**，接收到**否认分组**则**重新发送**
{%list%}
成功确认的分组将会从缓存中删除
{%endlist%}
{%right%}
使用超时计时器以防分组丢失，给分组添加序号防止分组重复和分组迟到
{%endright%}
{%warning%}
该方法的信道利用率较低，因为每次发送一个分组就需要等待一个往返时间
{%endwarning%}
**②回退N帧协议GBN**
>**发送方**：每次**发送N个分组**，若**N个分组均正确**，则发送**下一批分组**，若收到**NAKy否认分组**，则这一批分组中**y以及y之后的分组全部重发**

>**接收方**：每次接**收一个分组**并**逐个确认**，若接收到的**第x个分组以及之前的分组全部正确**，则发送**ACKx确认分组**，若**第y个分组发生错误**，则发送**NAKy否认分组**
{%right%}
每次可以发送多个分组，提高了信道的利用率
{%endright%}
{%warning%}
一个分组的错误会导致后续分组的重传，当信道质量较差时，效率较低
{%endwarning%}
**③选择重传协议SR**
>**发送方**：**可发送的分组范围**称为**发送窗口**，**落入发送窗口**且**没有被发送**的分组会被**发送**，**发送窗口**一直**向前移动**，只有收到**确认分组**的位置才能**顺利通过**，否则会被**卡住（超时或者收到错误分组）**，被**卡住**的地方**重新发送**

>**接收方**：**接收的分组范围**称为**接收窗口**，**落入接收窗口**的分组会被**逐个确认**，并发送**对应的信号**，**接收窗口**一直**向前移动**，只有**确认正确**的位置才能**顺利通过**
{%right%}
减小了错误分组对发送其他分组的影响
{%endright%}
#### 3.3PPP协议
{%list%}
PPP协议是目前使用最广泛的点对点数据链路层协议
{%endlist%}
**①构成**
>对各种**协议数据报**的**封装方法**，即如何**封装成帧**

>**链路控制协议LCP**，用于控制**不同数据链路**的连接
{%list%}
如面向字节的异步链路和面向比特的同步链路
{%endlist%}
>**网络控制协议NCPs**，用于**支持**不同的**网络层协议**

**②帧格式**
{%list%}
帧头包含标志字段、地址字段、控制字段和协议字段，帧尾包含帧检验序列和标志字段
{%endlist%}
>**标志字段**：PPP帧的**定界符**，取值为`0x7E`
{%right%}
当数据部分出现标志字段，采用字节填充法或者比特填充法改变其序列，接收方再将其转换回来即可
{%endright%}
>**地址字段**：包含**源MAC地址**和**目的MAC地址**
{%list%}
MAC地址是每个接口唯一的标识，也被称为硬件地址/物理地址，地址字段中的MAC地址会随着链路的改变改变
{%endlist%}
>假设从`MAC1`发送到`MAC2`再到`MAC3`，**地址字段**在**两段链路**上分别为`MAC1:MAC2`和`MAC2:MAC3`

>**控制字段**：

>**协议字段**：指明帧的**数据部分**交给什么**网络协议**处理

>**帧检验序列**：用于**检查**帧是否有**误码**

**③状态**
![PPP协议状态](/image/JW_3.png)
#### 3.4共享式局域网
**①概念**
{%list%}
在有线领域，交换式局域网已经取代了共享式局域网，无线领域由于其广播天性采用的依旧是共享式局域网
{%endlist%}
{%right%}
协调多个发送和接收站点对一个共享传输媒体的占用
{%endright%}
>**静态划分信道**：将**信道资源**划分给**不同的用户**，如**频分多址**、**时分多址**和**码分多址**
{%warning%}
该类方法不灵活，通常在无线网络的物理层中使用，而不在数据链路层使用
{%endwarning%}
>**动态接入控制**：**各个站点**通过**竞争**获得**链路的使用权**，现在**主要采用**的是**随机接入**
{%list%}
当总线空闲时，所有站点都可以发送帧，当两个设备的帧信号在总线上相遇，即发生了碰撞
{%endlist%}
**②CSMA/CD协议**
{%list%}
主要应用于使用广播信道的有线局域网
{%endlist%}
>**多址接入MA**：**多个设备**连接在**一条总线**上，**竞争**使用

>**载波监听CS**：每个设备在**发送帧之前**，**检测总线**是否**空闲（有96比特时间）**，如果**有则发送**
{%list%}
96比特时间为发送96个比特所需要的时间，也称为帧间最小间隔，使得所有站点可以平等的竞争信道，同时也可作为定界符
{%endlist%}
>**碰撞检测CD**：每个**发送帧**的设备**边发送边检测碰撞**，一旦**总线**上出现**碰撞**，则立即**停止发送**，一段时间后**重新发送**，
{%list%}
将链路端到端的往返时间称为争用期，若站点在发送信号后经过争用期还没检测到碰撞，则判定不会发生碰撞
{%endlist%}
{%right%}
若连续发生多次碰撞，则使用退避算法调整各个站点的回避时间，减小碰撞概率
{%endright%}
{%warning%}
帧的长度不能太小，必须保证发送该帧的时间大于争用期，否则无法在发送前检测碰撞，需要进行填充，同时也不能太大，否则会占用总线时间过长
{%endwarning%}
**③CSMA/CA协议**
{%list%}
主要应用于使用广播信道的无线局域网，因为无线信道很难检测碰撞，且意义不大，故采用碰撞避免CA
{%endlist%}
>**帧间间隔IFS**：所有**站点**必须在**持续检测**到**信道空闲**一段**指定时间**才能发送帧，这段时间即**帧间间隔**
{%right%}
不同帧的帧间间隔不同，越高优先级帧的帧间间隔越短，用于减少碰撞，其中SIFS帧是最短的帧间间隔，保证一个站点能做好准备
{%endright%}
>**退避时间**：在**某些情况**下，一些站点**发送帧**时在**帧间间隔**的基础上还需要**再等待退避时间**
{%list%}
如一个站点成功发送帧后需要连续发送下一个帧时，以避免一个站点长时间占用信道
{%endlist%}
>**信道预约**：**源站**在**发送帧之前**发送一个**RTS帧**，**目的站**收到后**返回**一个**CTS帧**，**源站收到CTS帧**后，**其他站暂停**发送帧，直到**通信完成**
{%right%}
RTS帧和CTS帧很短，发生碰撞以及碰撞产生的开销很小，但是可以保证通信不受干扰，所以是值得的
{%endright%}
>**虚拟载波监听**：**RTS帧**和**CTS帧**以及**数据帧**都包含了**对应通信时长**，所以**其他站**点只需要监听到**三个帧中的一个**，就能知道**信道占用时间**

#### 3.5交换式局域网
**①交换机**
>根据**帧**的**目标mac地址**，直接**单独转发**到**目标主机**
{%list%}
与共享信道不同，交换机中，每个MAC地址都有对应的接口，从而形成不同的信道，在互不干扰的情况下并行工作
{%endlist%}
{%right%}
当多个主机给同一个主机发送帧时，交换机会将多个帧缓存起来，再逐个发送给目标主机
{%endright%}
![交换机工作原理](/image/JW_4.png)
**②交换机帧转发过程**
>当交换机**接收到帧**后，会将**发送方**的**MAC地址**和**接口号**登记到**帧交换表**中
{%list%}
也称为交换机的自学习，如果已经登记过，便不会再次登记，随着工作的推进，记录将会越来越长
{%endlist%}
{%warning%}
帧交换表的记录项是有时效的，因为由于设备损坏等原因，接口对应的MAC地址可能会改变
{%endwarning%}
>读取**帧的目的地址**，并在**帧交换表**中查找**接口号**，若**找到**则**直接发送**

>若**没有**找到**目的地址**对应的**帧交换表项**，则会对**所有其他接口**发送该帧

>**目的主机**收到后**接受该帧**，**其他主机丢弃该帧**

**③生成树协议STP**
>为了提高**以太网**的**可靠性**，需要添加**冗余链路**
{%warning%}
但是环形链路可能造成广播帧在各个交换机之间反复转发
{%endwarning%}
{%right%}
交换机需要选择性的阻碍某些接口，以确保连通整个网络的同时又不形成环路
{%endright%}
{%list%}
每次物理拓扑发生变化时，都将进行生成树的重新计算
{%endlist%}
![生成树协议](/image/JW_5.png)
**④虚拟局域网VLAN**
{%warning%}
广播帧的发送较为频繁，若每次广播帧都会被整个以太网的所有主机接收，则会十分浪费网络资源
{%endwarning%}
{%right%}
需要使用虚拟局域网技术将以太网分为多个广播域，一个广播域的广播帧不会被另一个广播域接收
{%endright%}
>**每个端口**有对应的标识**PVID**，每当**端口发送帧**时，会给其插入**对应的VLAN标记**

>当**其余端口**接收到**帧**时，基于**端口的规则**，根据**PVID和VLAN标记的关系**决定**是否接受**该帧
{%list%}
交换机端口类型有Access、Trunk、Hybrid三种，其中Access常用于连接用户计算机，Trunk常用于交换机之间的连接，Hybrid皆可
{%endlist%}






